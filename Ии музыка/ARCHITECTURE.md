# Архитектура проекта

## Общая схема

```
┌─────────────────────────────────────────────────────────────┐
│                    Music Genre Classifier                  │
├─────────────────────────────────────────────────────────────┤
│  GUI Layer (gui.py)                                       │
│  ┌─────────────────────────────────────────────────────┐   │
│  │  MusicGenreClassifierGUI                            │   │
│  │  - create_gui()                                     │   │
│  │  - _select_file()                                   │   │
│  │  - _process_file()                                  │   │
│  └─────────────────────────────────────────────────────┘   │
├─────────────────────────────────────────────────────────────┤
│  Business Logic Layer                                     │
│  ┌─────────────────────────────────────────────────────┐   │
│  │  ModelManager (model_manager.py)                   │   │
│  │  - load_trained_model()                             │   │
│  │  - train_model()                                    │   │
│  │  - predict_genre()                                  │   │
│  └─────────────────────────────────────────────────────┘   │
│  ┌─────────────────────────────────────────────────────┐   │
│  │  AudioProcessor (audio_processor.py)                │   │
│  │  - extract_features()                               │   │
│  │  - validate_audio_file()                            │   │
│  │  - convert_audio_format()                           │   │
│  └─────────────────────────────────────────────────────┘   │
├─────────────────────────────────────────────────────────────┤
│  Configuration & Utilities                               │
│  ┌─────────────────────────────────────────────────────┐   │
│  │  config.py                                          │   │
│  │  - DATA_PATH                                        │   │
│  │  - GENRES                                           │   │
│  │  - MODEL_SETTINGS                                   │   │
│  └─────────────────────────────────────────────────────┘   │
│  ┌─────────────────────────────────────────────────────┐   │
│  │  utils.py                                           │   │
│  │  - setup_logging()                                  │   │
│  │  - check_dependencies()                             │   │
│  │  - get_system_info()                                │   │
│  └─────────────────────────────────────────────────────┘   │
├─────────────────────────────────────────────────────────────┤
│  Data & Models Layer                                      │
│  ┌─────────────────────────────────────────────────────┐   │
│  │  Audio Dataset                                      │   │
│  │  ├── classical/                                    │   │
│  │  ├── rock/                                          │   │
│  │  ├── pop/                                           │   │
│  │  └── ...                                            │   │
│  └─────────────────────────────────────────────────────┘   │
│  ┌─────────────────────────────────────────────────────┐   │
│  │  Trained Models                                     │   │
│  │  ├── best_model.pkl                                │   │
│  │  ├── scaler.pkl                                    │   │
│  │  └── label_encoder.pkl                             │   │
│  └─────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
```

## Компоненты системы

### 1. GUI Layer (gui.py)

**Назначение:** Графический интерфейс пользователя

**Основные классы:**
- `MusicGenreClassifierGUI` - главный класс GUI

**Ключевые методы:**
- `create_gui()` - создание интерфейса
- `_select_file()` - выбор файла
- `_process_file()` - обработка файла
- `_load_model()` - загрузка модели

**Особенности:**
- Асинхронная обработка файлов
- Прогресс-бары и статус-индикаторы
- Обработка ошибок с пользовательскими сообщениями

### 2. Business Logic Layer

#### ModelManager (model_manager.py)

**Назначение:** Управление моделью машинного обучения

**Основные методы:**
- `load_trained_model()` - загрузка обученной модели
- `train_model()` - обучение новой модели
- `predict_genre()` - предсказание жанра
- `_extract_dataset_features()` - извлечение признаков из датасета
- `_save_model()` - сохранение модели
- `_plot_results()` - визуализация результатов

**Используемые алгоритмы:**
- Random Forest Classifier
- GridSearchCV для оптимизации параметров
- StandardScaler для нормализации признаков

#### AudioProcessor (audio_processor.py)

**Назначение:** Обработка аудиофайлов и извлечение признаков

**Основные методы:**
- `extract_features()` - извлечение признаков
- `validate_audio_file()` - валидация файла
- `convert_audio_format()` - конвертация форматов

**Извлекаемые признаки:**
- MFCC (13 коэффициентов)
- Chroma (12 коэффициентов)
- Spectral Contrast (7 коэффициентов)
- Tonnetz (6 коэффициентов)
- Spectral Bandwidth
- RMS
- Zero Crossing Rate
- Tempo

### 3. Configuration & Utilities

#### config.py

**Назначение:** Централизованная конфигурация

**Основные настройки:**
- Пути к файлам и папкам
- Параметры аудиообработки
- Настройки модели
- Список поддерживаемых жанров

#### utils.py

**Назначение:** Вспомогательные функции

**Основные функции:**
- `setup_logging()` - настройка логирования
- `check_dependencies()` - проверка зависимостей
- `check_ffmpeg()` - проверка FFmpeg
- `validate_paths()` - валидация путей
- `get_system_info()` - информация о системе

### 4. Data & Models Layer

#### Структура данных

```
path_to_music_dataset/
├── classical/
│   ├── classical.00000.wav
│   ├── classical.00001.wav
│   └── ...
├── rock/
│   ├── rock.00000.wav
│   └── ...
└── ...
```

#### Обученные модели

- `best_model.pkl` - обученная модель Random Forest
- `scaler.pkl` - скейлер для нормализации признаков
- `label_encoder.pkl` - кодировщик меток жанров

## Поток данных

### 1. Обучение модели

```
Audio Files → AudioProcessor → Features → ModelManager → Trained Model
     ↓              ↓              ↓            ↓
  Validation    Feature      Training      Model
                Extraction   Process       Saving
```

### 2. Предсказание жанра

```
User Input → GUI → AudioProcessor → ModelManager → Result Display
     ↓         ↓         ↓              ↓
  File      File     Feature        Prediction
 Selection  Load    Extraction      & Display
```

## Технологический стек

### Основные библиотеки

- **librosa** - обработка аудио и извлечение признаков
- **scikit-learn** - машинное обучение
- **numpy** - численные вычисления
- **matplotlib/seaborn** - визуализация
- **tkinter** - графический интерфейс
- **pydub** - конвертация аудио

### Внешние зависимости

- **FFmpeg** - конвертация аудиоформатов
- **Python 3.8+** - среда выполнения

## Принципы архитектуры

### 1. Модульность

Каждый компонент имеет четко определенную ответственность:
- GUI - только интерфейс
- ModelManager - только ML логика
- AudioProcessor - только обработка аудио

### 2. Разделение ответственности

- **GUI Layer** - пользовательский интерфейс
- **Business Logic** - основная логика приложения
- **Data Layer** - данные и модели

### 3. Конфигурируемость

Все настройки вынесены в отдельный файл `config.py`

### 4. Обработка ошибок

- Логирование на всех уровнях
- Graceful degradation
- Пользовательские сообщения об ошибках

### 5. Тестируемость

- Unit тесты для каждого модуля
- Моки для внешних зависимостей
- Интеграционные тесты

## Расширяемость

### Добавление новых жанров

1. Добавить жанр в `GENRES` в `config.py`
2. Создать папку с файлами в `DATA_PATH`
3. Переобучить модель

### Добавление новых признаков

1. Модифицировать `extract_features()` в `AudioProcessor`
2. Обновить `expected_num_features` в `ModelManager`
3. Переобучить модель

### Замена алгоритма ML

1. Изменить алгоритм в `ModelManager.train_model()`
2. Обновить параметры GridSearch
3. Переобучить модель

## Производительность

### Оптимизации

- Кэширование загруженной модели
- Асинхронная обработка файлов
- Валидация файлов перед обработкой
- Оптимизация параметров модели

### Мониторинг

- Логирование времени выполнения
- Отслеживание использования ресурсов
- Метрики точности модели

## Безопасность

### Защита данных

- Валидация входных файлов
- Ограничение размера файлов
- Проверка форматов файлов

### Обработка ошибок

- Graceful handling исключений
- Логирование ошибок
- Пользовательские сообщения
